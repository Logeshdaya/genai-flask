<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdCraft Studio - AI Poster Generator</title>
    
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='luxury letter a logo design for business or online shop.png') }}">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="dark-mode"> 
    
    <div class="stars-bg"></div> 

    <header class="main-header">
        <div class="header-container">
            <h1 class="logo">
                <img src="{{ url_for('static', filename='cropped_circle_image.png') }}" alt="AdCraft Logo" class="header-logo">
                AdCraft
            </h1>
            <div id="export-controls" style="display: none;">
                <div class="dropdown-container">
                    <button id="download-btn" class="btn btn-success">Download</button>
                    <div class="dropdown-menu" id="download-menu">
                        <a href="#" id="download-png">as PNG</a>
                        <a href="#" id="download-jpg">as JPG</a>
                        <a href="#" id="download-pdf">as PDF</a>
                    </div>
                </div>
                <div class="dropdown-container">
                    <button id="share-btn" class="btn btn-secondary">Share</button>
                    <div class="dropdown-menu" id="share-menu">
                        <a href="#" id="share-file-btn">Share File...</a>
                        <a href="#" id="share-whatsapp-btn">Share to WhatsApp</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        
        <div id="wizard-container">
            <section class="step glass-panel" id="step-1">
                <div class="step-header">
                    <h2><span class="step-number">1</span> // CONCEPT</h2>
                    <p>Provide the core directive. The AI will extrapolate.</p>
                </div>
                <div class="step-content">
                    <label for="raw-prompt">Your Directive (Prompt)</label>
                    <textarea id="raw-prompt" rows="3" placeholder="e.g., A minimalist ad for 'ZEPHYR' running shoes, showing speed.">A poster for a coffee brand 'ROCKET FUEL', showing a stylized rocket launching from a coffee mug. Bold, red text.</textarea>
                    <button id="conceptualize-btn" class="btn btn-primary">
                        <span class="btn-text">Enrich Directive</span>
                        <span class="spinner-small" style="display: none;"></span>
                    </button>
                </div>
            </section>

            <section class="step glass-panel" id="step-2" style="display:none;">
                <div class="step-header">
                    <h2><span class="step-number">2</span> // REFINE & GENERATE</h2>
                    <p>Authorize parameters for the generation matrix.</p>
                </div>
                <div class="step-content">
                    <div class="tool-group">
                        <label for="enriched-prompt">AI-Generated Creative Brief</label>
                        <textarea id="enriched-prompt" rows="6"></textarea>
                    </div>

                    <div class="tool-group">
                        <label for="image-upload-input">Input Image (Optional)</label>
                        <input type="file" id="image-upload-input" accept="image/*" class="file-input">
                        <label for="image-upload-input" class="file-input-label">
                            Click to upload an image...
                        </label>
                        <div id="image-preview-container" style="display: none;">
                            <img id="image-preview" src="#" alt="Input preview" />
                            <button id="remove-image-btn">&times;</button>
                        </div>
                    </div>
                    
                    <div class="tool-group">
                        <label for="model-selector">Generation Model</label>
                        <select id="model-selector">
                            <option value="fal-ai/flux-pro/v1.1-ultra" selected>FLUX 1.1 Pro</option>
                        </select>
                    </div>

                    <button id="generate-btn" class="btn btn-primary">
                        <span class="btn-text">Generate Poster</span>
                        <span class="spinner-small" style="display: none;"></span>
                    </button>

                    <div id="generation-metrics" class="metrics-container" style="display: none;">
                        <div class="metric-card">
                            <span class="metric-label">Previous Time</span>
                            <span id="prev-duration-display" class="metric-value">--</span>
                        </div>
                        <div class="metric-card">
                            <span class="metric-label">Current Time</span>
                            <span id="curr-duration-display" class="metric-value val-current">0.00s</span>
                        </div>
                        <div class="metric-card">
                            <span class="metric-label">Difference</span>
                            <span id="duration-diff-display" class="metric-value">--</span>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <div id="editor-workspace" style="display: none;">
            
            <aside class="inspector-panel glass-panel">
                <div class="inspector-header">
                    <button id="back-to-wizard-btn" class="back-button" title="Go Back">&larr; Back</button>
                    <h3>// TOOLSET</h3>
                </div>
                
                <div class="inspector-section">
                    <label class="section-label">Add Layers</label>
                    <div class="tool-grid">
                        <button id="add-text-btn" class="tool-btn">Add Text</button>
                        <label class="tool-btn file-upload">
                            Add Image
                            <input type="file" id="upload-image-btn" accept="image/*">
                        </label>
                        <button id="inpaint-tool-btn" class="tool-btn" title="Generative Fill">
                            âœ¨ Gen Fill
                        </button>
                    </div>
                </div>
                
                <div id="inpaint-controls" class="inspector-section" style="display: none; border: 1px solid var(--color-primary); background: rgba(0,255,100,0.05);">
                    <label class="section-label" style="color: var(--color-primary);">Generative Fill</label>
                    
                    <div class="tool-group">
                        <label>Paint over the object to change</label>
                        <div class="dual-input-row">
                            <span class="sub-label">Brush Size</span>
                            <input type="range" id="brush-size-slider" min="10" max="100" value="40">
                        </div>
                    </div>

                    <div class="tool-group">
                        <label>Prompt</label>
                        <textarea id="inpaint-prompt" rows="2" placeholder="e.g., a cup of tea" style="width:100%; padding:8px; border-radius:4px; border: 1px solid #444; background: #222; color: #fff;"></textarea>
                    </div>

                    <div class="tool-grid-2-col">
                        <button id="run-inpaint-btn" class="btn btn-primary">Generate</button>
                        <button id="cancel-inpaint-btn" class="btn btn-secondary">Cancel</button>
                    </div>
                </div>

                <div id="contextual-tools" style="display: none;">
                    
                    <div id="text-tools" class="inspector-section" style="display: none;">
                        <label class="section-label">Text Properties</label>
                        <div class="tool-group">
                            <label for="font-family">Font</label>
                            <select id="font-family">
                                <option value="Arial">Arial</option>
                                <option value="Impact">Impact</option>
                                <option value="Poppins">Poppins</option>
                                <option value="Roboto Mono">Roboto Mono</option>
                                <option value="Oswald">Oswald</option>
                            </select>
                        </div>
                        <div class="tool-grid-2-col">
                            <div class="tool-group">
                                <label for="font-size">Size</label>
                                <input type="number" id="font-size" value="40" min="1">
                            </div>
                            <div class="tool-group">
                                <label for="font-color">Color</label>
                                <input type="color" id="font-color" value="#FFFFFF">
                            </div>
                        </div>
                        
                        <div class="tool-group">
                            <label>Typography</label>
                            <div class="dual-input-row">
                                <div style="width: 50%;">
                                    <span class="sub-label">Spacing</span>
                                    <input type="number" id="letter-spacing" value="0" step="10" style="width: 100%;">
                                </div>
                                <div style="width: 50%;">
                                    <span class="sub-label">Line Height</span>
                                    <input type="number" id="line-height" value="1.2" step="0.1" style="width: 100%;">
                                </div>
                            </div>
                        </div>
                        <div class="tool-group">
                            <label>Style</label>
                            <div class="tool-grid-3-col">
                                <button id="text-bold-btn" class="toggle-btn" title="Bold"><b>B</b></button>
                                <button id="text-italic-btn" class="toggle-btn" title="Italic"><i>I</i></button>
                                <button id="text-underline-btn" class="toggle-btn" title="Underline"><u>U</u></button>
                            </div>
                        </div>

                        <div class="tool-group">
                            <label>Outline & Glow</label>
                            <div class="dual-input-row">
                                <input type="number" id="stroke-width" placeholder="Width" value="0" min="0">
                                <input type="color" id="stroke-color" value="#000000">
                            </div>
                            <div class="dual-input-row" style="margin-top:5px;">
                                <input type="number" id="shadow-blur" placeholder="Blur" value="0" min="0">
                                <input type="color" id="shadow-color" value="#00FFFF">
                            </div>
                        </div>

                        <div class="tool-group">
                            <label>Align</label>
                            <div class="tool-grid-3-col">
                                <button id="text-align-left-btn" class="toggle-btn" title="Align Left">Left</button>
                                <button id="text-align-center-btn" class="toggle-btn" title="Align Center">Center</button>
                                <button id="text-align-right-btn" class="toggle-btn" title="Align Right">Right</button>
                            </div>
                        </div>
                        <div class="tool-group">
                            <label for="text-bg-color">Background Color</label>
                            <input type="color" id="text-bg-color" value="#FFFFFF">
                        </div>
                    </div>

                    <div id="image-tools" class="inspector-section" style="display: none;">
                        <label class="section-label">Image Filters</label>
                        <div class="tool-group">
                            <label>Presets</label>
                            <div class="filter-grid">
                                <button id="filter-grayscale-btn" class="toggle-btn filter-btn">B&W</button>
                                <button id="filter-sepia-btn" class="toggle-btn filter-btn">Sepia</button>
                                <button id="filter-invert-btn" class="toggle-btn filter-btn">Invert</button>
                            </div>
                        </div>
                        <div class="tool-group">
                            <label for="img-blur">Blur Effect</label>
                            <input type="range" id="img-blur" min="0" max="1" step="0.05" value="0">
                        </div>
                    </div>
                    <div id="common-tools" class="inspector-section">
                        <label class="section-label">Object Properties</label>
                        
                        <div class="tool-group">
                            <label for="blend-mode">Blend Mode</label>
                            <select id="blend-mode" class="blend-mode-select">
                                <option value="normal">Normal</option>
                                <option value="multiply">Multiply (Darken)</option>
                                <option value="screen">Screen (Lighten)</option>
                                <option value="overlay">Overlay</option>
                            </select>
                        </div>

                        <div class="tool-group">
                            <label for="rotation-slider">Rotation</label>
                            <input type="range" id="rotation-slider" min="0" max="360" step="1" value="0">
                        </div>

                        <div class="tool-group">
                            <label for="opacity-slider">Opacity</label>
                            <input type="range" id="opacity-slider" min="0" max="1" step="0.01" value="1">
                        </div>
                        
                        <label>Layer Order</label>
                        <div class="tool-grid-2-col">
                            <button id="bring-front-btn" class="tool-btn">To Front</button>
                            <button id="send-back-btn" class="tool-btn">To Back</button>
                        </div>
                    </div>
                </div>
                
                <div class="inspector-section danger-zone">
                    <button id="delete-btn" class="btn btn-danger" style="display: none;">Delete Selected</button>
                    <button id="clear-canvas-btn" class="btn btn-danger-outline">Clear All Edits</button>
                </div>
            </aside>
            
            <section class="canvas-area glass-panel">
                <div id="loading-spinner" class="spinner" style="display: none;"></div>
                <div id="editor-container">
                    <canvas id="poster-canvas"></canvas>
                </div>
            </section>
        </div>
    </main>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>